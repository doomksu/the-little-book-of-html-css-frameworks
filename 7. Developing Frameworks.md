#Разработка Фреймворков
Разработка фреймворков — это своего рода искусство которое сочетается с большой ответственностью. В случае открытого (вставить термин со стр 1 Key Concepts) фреймворка ответственность приходит вместе с аурой риска (хотя наивность также увеличивается). Как мы уже выяснили ранее в этой книге, до крайности сложно разработать открытый фреймворк так как мы не можем знать что потребуется для других проектов. И потому мы можем избежать разработки чего то незавершенного – что могло бы превратиться в мыльный пузырь.

На следующих страницах описаны основы разработки фреймворка. Изложенные идеи описывают реальные обстоятельства в которых опытный веб разработчик управлял успешным фреймворком в крупной организации. 
##Принципы
Мы уже выполнили наше задание и выделили принципы разработки фреймворка. Фреймворк должен следовать наивысшим стандартам качества а так же:

* Фреймворк должен быть выполнен в строгом соответствии с задачей(сверить с переводом темы из главы Attributes of a Good Framework)
* Фреймворк должен быть пригоден к использованию
* Фреймворк должен быть расширяемым

Эти правила должны быть базовыми для всех разрабатываемых фреймворков (для которых мы можем  использовать направление обозначенное ранее).

Установка «1.Фреймворк должен быть выполнен в строгом соответствии с задачей»(сверить с переводом темы из главы Attributes of a Good Framework) играет здесь особую роль, это секретное оружие и последняя линия обороны для разработчика открытых фреймворков. Единственная возможность настроится на сторонних пользователей, проектов которых мы возможно никогда не узнаем, это предложить  возможность настройки фреймворка.

Я решил не включать главу о настройке, потому что это не волшебная  пилюля для фреймворка и может смешать все карты разработчику фреймворка в угоду  пользователя. Это потому что чем больше возможность для настройки, тем сложнее получается фреймворк. Но пока это все разговоры о разработке.  Фреймворк и все его пользовательские версии, как мы уже видели, все еще нуждается в тестировании, контроле качества, обслуживании итд.
##Прототип
Наиболее важной частью построения успешного фреймворка является прототипирование. Здесь мы получаем выгоду от осознания того, что мы только говорили о простых vanilla стилях и скриптах. Большие проекты – проекты фреймворки, которые мы сейчас обсуждаем – всегда выигрывают от прототипирования.

Что мы подразумеваем под прототипом? В самом простом варианте это статический (внутренний) сайт или демо сайт. Он должен содержать всю документацию и элементы, необходимые нам в реализации: в прототипе мы выстраиваем всю структуру (HTML), отображение (CSS) и поведенческую часть (JavaScript). Прототип должен содержать реалистичные (иногда до крайности реалистичные) примеры наполнения, таким образом мы проверяем что все работает.

Пртотипирование это незаменимая основа для тестирования, необходимая нам для достижения требуемого результата.

Прототипы следуют своим собственным принципам, так или иначе они должны быть, как я пытался сформулировать в ранние годы (другими словами):

* Завершенными
* Текущими
* Реалистичными
* Сфокусированными
* Доступными
* Управляемыми в соответствии с установленной практикой
* Обслуживаемыми
* Коммуникативными() /продвигаемыми
* Задокументированными

Каждый из этих пунктов важен, но первые три особенно. Прототип должен собрать все (все типы документов и элементы), он должен быть текущим (любые функциональные изменения должны отражаться незамедлительно), и он должен быть реалистичным (примеры наполнения должны быть, насколько это возможно, приближены к тому, как прототип будет использоваться вне фреймворка).

##Управление Качеством

Для того что бы удостовериться что мы предоставляем тот уровень качества который соответствует нашему профессионализму, мы должны проверять его. Это осуществляется через гарантию качества (которая направлена на предотвращение ограничений фокусированием на процессе).

Веб-разработка, как все еще относительно молодое направление, имеет больше способов контроля качества, чем гарантия качества. Хорошими примерами являются валидация, проверки отображения и доступности, каких есть великое множество. Что касается гарантий качества, наиболее явным примером является введение руководство разработки, но некоторые организации и отдельные личности идут дальше, разрабатывая детальную инфраструктуру для непрерывного тестирования и улучшения кода. (Все это в меньшей степени относится к веб-разработке, нежели к разработке прикладного программного обеспечения, поскольку у нее существует более длинная история и традиции работы с тестами).

Для контроля качества полезно применять:

* Налаживание руководства разработки
* Определение критериев оценки качества
* Проведение регулярных тестов (на прототипе и реальной реальных реализациях)
* Для контроля качества тестируется:
* Доступность
* Связность (если применима)
* Отображение 
* Отзывчивость 
* Поддерживаемость
* Валидность
* Анализируемость (в сноску можно https://ru.wikipedia.org/wiki/Lint)
* Следование принятым форматам

(Кстати я запустил сайт посвященный средствам тестирования в веб-разработке. Посмотрите uitest.com/en/analysis/ для получения выбора этих инструментов.)

Чтобы получить страницу из Google book, лучше автоматизировать такие проверки. Изучение документации средств может быть полезным для получения знаний о средствах которые можно установить локально или использовать с API. Так же существуют инструменты такие как Selenium и ChromeDriver, которые облегчают автоматизированное тестирование в браузере. Так же как и со многими более сложными темами, эта книга всего лишь указывает направление.

##Обслуживание

Мы многое отметили о том как важны принципы прототипирования и управления в разработке фреймворка. Последней причинной для беспокойства является обслуживание. Обслуживание здесь главным образом означает большую ответственность в дальнейшей работе с фреймворком. Это важно по двум причинам.

Во первых в случае открытого (термин со стр 1 Key Concepts) фреймворка обслуживание является критически важным, так как публикация фреймворка это ответственность перед пользователями. Эта ответственность заключается в том что фреймворк точно будет обслуживаться . А так же ответственность за то как будет происходить обслуживание, поэтому мы делаем все что в наших силах чтобы не изменять никаких структур, а лишь стили представления и скрипты.

Во вторых, для любого фреймворка ответственность за изменения это еще одна форма безопасности. Главная идея веб-разработки заключается в том, что правильная структура HTML наиболее важна, потому что изменения в ней стоят дороже – если рассматривать наше определение цены (термин со стр 1 Key Concepts)– чем изменения в таблицах стилей и скриптах. Ясное соглашение о поддержке удержит нас от того что бы забросить фреймворк для того что бы просто “написать новый” и таким образом оправдывает подход разработки через итерации и рефакторинг только для CSS. (Конечно же настоящие структурные изменения всегда требуют внесения изменений в HTML и вместе с этим, в конечном счете, редактирование CSS  и JavaScript.)

Фреймворк, который решает  распространенные и комплексные проблемы по разработке и дизайну непременно следует с точно сформулированными соглашениями о поддержке.

###Обслуживание и Поломки

Немного внимания: будучи разработчиками фремворка мы должны проявлять ответственность и заботу о том что бы не повредить(сломать) что-либо, и в то же время мы не должны слишком волноваться об этом. На вопрос о том что является самым важным при разработке и поддержке фреймворка я ответил несколько лет назад:

“Чем больше используется фреймворк и следовательно чем он успешнее, тем больше вероятность того что,  что-нибудь будет повреждено при очередном обновлении. […] поддержка это ключ к обеспечению отказоустойчивости, но полностью обезопасить от поломок она все еще не в состоянии, а попытки к тому обходятся невероятно дорого. Впоследствии когда поломки будут возникать, они никогда не станут катастрофой. Это приводит нас снова к установлению ожиданий: […] людям следует принимать обновления а не опасаться их.”

Я надеюсь что этот совет все еще остается весомым. Код не должен доставлять беспокойств. Если мы как разработчики выполняем свою работу прилежно, случайные поломки могут послужить хорошим (возможно даже единственно возможным) случаем для того что бы показать пользователям фреймворка основы и методики правильного использования фреймворка и ознакомить с остальными вопросами связанными с разработкой. При разработке нам иногда приходится принимать трудные решения.

##Обновления

Проведение обновления фреймворка, достаточно деликатная тема и ей стоит посвятить отдельную главу. Обновления для встроенных(внутренних) фреймворков обычно проводить легче чем для внешних, хотя проведение обновлений в больших организациях, где много разработчиков распределенных по разным отделам, может стать испытанием

Вот несколько советов которые помогут облегчить обновления фреймворка.

* Старайтесь избегать изменений в HTML из-за их сравнительно высокой стоимости. Обновления должны заключаться в изменениях стилей отображения или скриптов и не создавать дополнительной работы для пользователей (это так же означает других разработчиков, которые работают с фреймворком). Обновления комментариев к фреймворку вполне допустимы.
* Заранее сообщайте о планируемых обновлениях
* Обеспечьте возможность проверять обновления на вредные побочные эффекты. Это можно сделать простым путем с помощью букмарклетов (смотри “Тестирование с помощью букмарклетов (тестовые букмарклеты)” на странице 23) или более сложным, таким как перенаправления (используйте перенаправления что бы перехватить запрос к файлам фреймворка и направить его к обновленным файлам что бы проверить их работу).
* Предупреждайте пользователей о возможных побочных эффектах обновления (и используйте эту возможность что бы предупредить их к примеру о перезаписи, которая описывается в главе “2. Не перезаписывайте код фреймворка” на странице 15).
* Сообщайте о текущем состоянии готовящегося(следующего) изменения.

Мы предполагаем, что мы не просто пишем новые версии фреймворков. Такова практика отношения к фреймворку, назовем его foo и когда появится первая версия, мы не станем обновлять foo, но начнем работать с foo-2 и foo -3 и так далее. Мы можем применять подобный подход, но он не должен быть для нас правилом. Правилом должно быть обновлять сам фреймворк, в соответствии с изложенными взглядами. Причина в том что такое управление версиями сводит на нет цели и ценности CSS (так же как и JavaScript), из-за чего он, поддерживая соглашение о [разделении ответственности](https://ru.wikipedia.org/wiki/Разделение_ответственности)  (HTML для структуры, CSS для отображения и JavaScript для определения поведения ). Мы немного коснемся идеи стоящей за этим, и должны прилагать все усилия чтобы все изменения учитывали то что мы уже сделали. И только в случае значительных изменений, мы внимательно изучаем возможности и всегда с осторожностью пересматриваем версии.

###Тестовые букмарклеты

CSS букмарклеты замечательный не требовательный способ  протестировать изменения в фреймворке. Вот короткий пример:


До изменения:

    article {
       margin: auto;
       width: 50%;
    }
После  изменения:

    article {
        width: 90%;
    }
Для того чтобы подготовить тест для изменений и убедиться что все работает  как и планировалось, необходимо записать все измененные определения и все удаленные определения и для удаленных установить значения по умолчанию и на основании этого создать правила для тестирования.

Правила для тестирования:

    article {
        margin: 0;
        width: 90%;
    }
Мы упрощаем этот пример полагая что <article> не наследует откуда-либо других margin свойств. margin должен быть установлен, поскольку при удалении его из новой версии он остается установленным в старой, что сказывается на отображаемом результате когда мы тестируем код. Таким образом тестовые стили должны подавлять весь старый код – иногда, в особенных случаях, как последнее средство, мы можем применять [свойство all](http://bit.ly/w3_all-property).

##Документирование

Несмотря на то что технически документирование не относится к процессу разработки, его необходимо обсудить. Лучше всего фиксировать документацию сразу по мере написания кода, во первых увеличиваются шансы что это вообще будет сделано, во вторых документация получается более точной и полной потому что мы еще не успели что-либо забыть.

Существует несколько способов вести документацию, но один из наиболее  эффективных это использование прототипа. Примеры наполнения могут сформировать документацию, которая описывает типы страниц и элементов из которых  они состоят, так же можно создать подсказки, которые будут отображаться при наведении, они раскрывать исходные данные и пояснять код. (Поддерживаемый прототип, снабженный такими пояснениями,  может сделать большую часть работы по создании любого сайта с использованием фреймворка!)

Документация вводится в процессе разработки, и для этого нужно закрепить определенный порядок.  Наше руководство разработки должно определять стандарты(принципы) документирования  такие как CSSDOC и JSDOC,  инструменты, автоматически собирающие такую документацию из нашего кода, так же будут очень полезны. Цель документации в том что бы облегчить жизнь нам самим, нашим коллегам, пользователям и любым людям заинтересованным во фреймворке.  Это объясняет почему документация становится частью процесса разработки, имеющей существенное значение.

##Логистика

Теперь кода мы усердно проработали все связанное с фреймворками,  мы близки к завершению. Дополнительно требуется обсудить вопрос логистики. Мы уже рассмотрели некоторые части которые можно отнести к логистике: 
* Руководство разработки
* Инструменты контроля качества
* Документация

Что мы еще не обсудили: 

* План или дорожная карта разработки фреймворка
* Системы контроля версий (такие как like Git, Mercurial, or Subversion)
* Система отслеживании ошибок (такая как Bugzilla)
* Сайт фреймворка (общедоступный, если фреймворк открытый)  с новостной лентой
* Список почтовой рассылки для
 * Разработчиков (команды разработчиков фреймворка)
 * Пользователей (открытый для всех)
 * Уведомлений (нерегулярные рассылки для рассмотрения основных вопросов, отправляются и разработчикам и пользователям)
* Трекеры для реализации.
 
Сайт фреймворка и рассылка уведомлений  заслуживает внимания, так как могут принести выгоду владельцам фреймворка и его разработчикам. Сайт служит источником информации и документации. Уведомления необходимы для оповещения клиентов о новых релизах  и руководства пользователей. 

Поддержка так же относится к разделу логистики. Здесь мы  не будем ее рассматривать, потому что мы понемногу включали вопросы поддержки на протяжении всей книги—при рассмотрении целей и методов обеспечения качества, в разделе документации и логистики, а так же потом что  поддержка это обособленный раздел, который зависит  от сложности фреймворка и его целей.

Повторим, для разработки фреймворка нам нужно обратить внимание на:

* Принципы
* Прототипирование
* Управление качеством 
* Обслуживание
* Документацию
* Логистику

Эти пункты расположены в порядке убывания их важности, наш фреймоворк еще может существовать в условиях слабой поддержки и неполной документации, но его точно погубит плохое отображение, недостаток тестирования и ответственности.
